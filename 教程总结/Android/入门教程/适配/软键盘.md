

显示或隐藏键盘
```
  public static void showSoftInput(View view) {
    if (view != null) {
      if (isSystemKeyboardVisible(view.getContext())) {
        return;
      }
      Timer timer = new Timer();
      //让view获取焦点，否则需要再次点击才能输入
      view.requestFocus();
      timer.schedule(new TimerTask() {
        @Override public void run() {
          InputMethodManager inputManager =
              (InputMethodManager) view.getContext().getSystemService(Context.INPUT_METHOD_SERVICE);
          inputManager.toggleSoftInput(InputMethodManager.SHOW_FORCED, 0);
          inputManager.showSoftInput(view, InputMethodManager.SHOW_IMPLICIT);
        }
        timer.cancel();
      }, 200);
    }
  }

  public static void hideSoftInput(View view) {
    if (view != null) {
      //先清除焦点，防止自动拉起
      view.clearFocus();
      InputMethodManager manager =
          ((InputMethodManager) view.getContext().getSystemService(Context.INPUT_METHOD_SERVICE));
      if (manager != null) {
        manager.hideSoftInputFromWindow(view.getWindowToken(), 0);
      }
    }
  }
  
  //通过反射实现的，todo 其他方式
  //也可以布局检查 https://github.com/Blankj/AndroidUtilCode/blob/master/lib/utilcode/src/main/java/com/blankj/utilcode/util/KeyboardUtils.java
  //https://stackoverflow.com/questions/4745988/how-do-i-detect-if-software-keyboard-is-visible-on-android-device-or-not
  public static boolean isSystemKeyboardVisible(Context context) {
    try {
      final InputMethodManager manager = (InputMethodManager) context.getSystemService(Context.INPUT_METHOD_SERVICE);
      final Method windowHeightMethod = InputMethodManager.class.getMethod("getInputMethodWindowVisibleHeight");
      final int height = (int) windowHeightMethod.invoke(manager);
      return height > 0;
    } catch (Exception e) {
      return false;
    }
  }
```

https://www.jianshu.com/p/15b688c0de04
点击空白隐藏键盘
缺点：页面中存在两个editText,点击另一个EditText会看到键盘隐藏然后再显示。
BaseActivity中
```
  @Override public boolean dispatchTouchEvent(MotionEvent ev) {
    SoftInputUtil.hideKeyBoardClickBlank(ev,this);
    return super.dispatchTouchEvent(ev);
  }
  
//util
  //点击空白时隐藏键盘
  public static void hideKeyBoardClickBlank(MotionEvent ev, Activity activity){
    if (ev.getAction() == MotionEvent.ACTION_DOWN ) {
      View view = activity.getCurrentFocus();
      if (isShouldHideKeyBord(view, ev)) {
        hideSoftInput(view);
      }
    }
  }
 
 //点击区域在非editText隐藏，点击editText忽略
 public static boolean isShouldHideKeyBord(View v, MotionEvent event) {
    if (v != null && (v instanceof EditText)) {
      int[] l = { 0, 0 };
      v.getLocationInWindow(l);
      int left = l[0], top = l[1], bottom = top + v.getHeight(), right = left + v.getWidth();
      if (event.getX() > left && event.getX() < right && event.getY() > top
          && event.getY() < bottom) {
        // 点击EditText的事件，忽略它。
        return false;
      } else {
        return true;
      }
    }
    return false;
  }   
```


监听键盘，键盘弹起后部分布局移动，一般需要把背景和布局分离
https://blog.csdn.net/qq_20451879/article/details/79853154  todo区域计算
//可以不使用scrollView，直接使用setTranslationY即可，root是需要移动的容器,scrollToView是被键盘遮挡的布局，可能是editText，可能是button
```
private void controlKeyboardLayout(final View root, final View scrollToView) {
    root.getViewTreeObserver().addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {
      @Override
      public void onGlobalLayout() {
        Rect rect = new Rect();
        //获取root在窗体的可视区域  
        root.getWindowVisibleDisplayFrame(rect);
        //获取root在窗体的不可视区域高度(被其他View遮挡的区域高度)
        int rootInvisibleHeight = root.getRootView().getHeight() - rect.bottom;
        if (Math.abs(rootInvisibleHeight - recordVisibleRec) > 200) {
          //若不可视区域高度大于200，则键盘显示
          if (rootInvisibleHeight > 200) {
            int[] location = new int[2];
            //获取scrollToView在窗体的坐标
            scrollToView.getLocationInWindow(location);
            //计算root滚动高度，使scrollToView在可见区域
            int srollHeight = (location[1] + scrollToView.getHeight()) - rect.bottom;
            srollHeight = srollHeight < 0 ? 0 : srollHeight;
             if (srollHeight > 1) {
                  srollHeight += 10; //多移动点，键盘与布局有个边
                }
            root.setTranslationY(-srollHeight);
          } else {
            //键盘隐藏
            root.setTranslationY( 0);
          }
        }
        recordVisibleRec = rootInvisibleHeight;
      }
    });
  }
```