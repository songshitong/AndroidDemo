https://cloud.tencent.com/developer/article/1481136

JVM
JVM的作用是把平台无关的.class里面的字节码翻译成平台相关的机器码，来实现跨平台。

DVM
安卓虚拟机DVM。Android中的所有Java程序都是运行在DVM上的，每个Android应用进程对应着一个独立的Dalvik虚拟机实例并在其解释下执行。
 DVM没有遵循Java虚拟机规范，不能直接执行Java的.class文件，而是执行.dex文件。它使用的是寄存器架构而不是JVM中常见的栈架构。
 其中.dex（Dalvik Executable）文件是通过.class文件转化而来，安卓使用Java语法编写应用程序，可以直接使用大部分的Java API等。

在编译过程中，Java把类编译成一个或多个.class字节码文件，然后打包到jar中。JVM会从jar文件中获得相应的.class文件和jre字节码。
DVM虽然也是是用Java语言进行编程， Java程序通过编译后，还需要通过SDK中的dex工具.class文件转化打包成.dex格式文件，DVM再从其中读取指令和数据。

JVM与DVM 二者最大的区别在于JVM是以基于栈的虚拟机(Stack-based)，而DVM是基于寄存器的虚拟机(Register-based)。
基于寄存器的虚拟机虽然比基于堆栈的虚拟机在硬件通用性上要差一些，但是它的代码执行效率却更好。 显然，后者最大的好处在于可以根据硬件实现更大的优化，
这更适合移动设备的特点。DVM非常适合在移动终端上使用，与PC相比，它不需要很快的CPU和大量的内存空间.

Java类文件在编译过后，会产生至少一个.class文件包含大量冗余信息，dex文件格式会把所有 的.class文件内容整合到一个.dex文件中。
通常一个应用apk只有一个classes.dex，但是开启了multiDexEnabled true分包可以生成多个.dex文件。即减少了整体文件的尺寸和IO操作，
也提高了类的查找速度。增加了对新的操作码的支持，使文件结构尽量简洁，使用等长的指令，借以提高解析速度


ART虚拟机
ART(Android Runtime)是Android 4.4发布的，用来替换Dalvik虚拟，Android 4.4之前默认采用的还是DVM，系统会提供一个选项来开启ART模式。
在Android 5.0时，默认采用ART，DVM从此退出历史舞台。

Dalvik虚拟机执行的是dex字节码，ART虚拟机执行的是本地机器码。

Dalvik执行的是dex字节码，依靠JIT编译器去解释执行，运行时动态地将执行频率很高的dex字节码翻译成本地机器码，然后在执行，
但是将dex字节码翻译成本地机器码是发生在应用程序的运行过程中，并且应用程序每一次重新运行的时候，都要重新做这个翻译工作，
因此，即使采用了JIT，Dalvik虚拟机的总体性能还是不能与直接执行本地机器码的ART虚拟机相比。

安卓运行时从Dalvik虚拟机替换成ART虚拟机，并不要求开发者重新将自己的应用直接编译成目标机器码，也就是说，应用程序仍然是一个包含dex字节码的apk文件。
所以在安装应用的时候，dex中的字节码将被编译成本地机器码，之后每次打开应用，执行的都是本地机器码。移除了运行时的解释执行，效率更高，
启动更快。（安卓在4.4中发布了ART运行时）

https://juejin.cn/post/6844903748058218509  
相比于 Dalvik，ART 对 Garbage Collection（GC）过程的也进行了改进：
1 只有一次 GC 暂停（Dalvik 需要两次）
2 在 GC 保持暂停状态期间并行处理
3 在清理最近分配的短时对象这种特殊情况中，回收器的总 GC 时间更短
4 优化了垃圾回收的工效，能够更加及时地进行并行垃圾回收，这使得 GC_FOR_ALLOC 事件在典型用例中极为罕见
5 压缩 GC 以减少后台内存使用和碎片


ART全面兼容 64 位

Android 7.0 —— JIT 回归
形成 AOT/JIT 混合编译模式，这种混合编译模式的特点是：
应用在安装的时候 dex 不会被编译
应用在运行时 dex 文件先通过解析器（Interpreter）后会被直接执行（这一步骤跟 Android 2.2 - Android 4.4之前的行为一致），
    与此同时，热点函数（Hot Code）会被识别并被 JIT 编译后存储在 jit code cache 中并生成 profile 文件以记录热点函数的信息。
手机进入 IDLE（空闲） 或者 Charging（充电） 状态的时候，系统会扫描 App 目录下的 profile 文件并执行 AOT 过程进行编译。

ART优点：
①系统性能显著提升
②应用启动更快、运行更快、体验更流畅、触感反馈更及时
③续航能力提升
④支持更低的硬件

ART缺点
①更大的存储空间占用，可能增加10%-20%
②更长的应用安装时间