åˆ¤æ–­ç¼“å­˜æ˜¯å¦è¿‡æœŸ
â€¢ response_is_fresh = (freshness_lifetime > current_age)
  â€¢ freshness_lifetimeï¼šæŒ‰ä¼˜å…ˆçº§ï¼Œå–ä»¥ä¸‹å“åº”å¤´éƒ¨çš„å€¼
    â€¢ s-maxage > max-age > Expires > é¢„ä¼°è¿‡æœŸæ—¶é—´
      â€¢ ä¾‹å¦‚ï¼š
        â€¢ Cache-Control: s-maxage=3600
        â€¢ Cache-Control: max-age=86400
        â€¢ Expires: Fri, 03 May 2019 03:15:20 GMT
          â€¢ Expires = HTTP-dateï¼ŒæŒ‡æ˜ç¼“å­˜çš„ç»å¯¹è¿‡æœŸæ—¶é—´
å›¾ç‰‡ä¸ºNGINXçš„è®¡ç®— å–åˆ°s-maxageåä¸å†å–max-ageçš„å€¼äº†   

ä¸ºä»€ä¹ˆè¦é¢„ä¼°ç¼“å­˜æ—¶é—´ï¼Ÿ    å›¾ç‰‡ï¼Œjs,cssæ˜¯ç›¸å¯¹ä¸æ€ä¹ˆå˜åŒ–çš„
 ç»Ÿè®¡å¾—çŸ¥55%çš„è¯·æ±‚æ²¡æœ‰æºå¸¦max-age
 

å¸¸è§çš„é¢„ä¼°æ—¶é—´
â€¢ RFC7234 æ¨èï¼šï¼ˆDownloadTimeâ€“ LastModified)*10%


Age å¤´éƒ¨åŠ current_age çš„è®¡ç®—
â€¢ Age è¡¨ç¤ºè‡ªæºæœåŠ¡å™¨å‘å‡ºå“åº”ï¼ˆæˆ–è€…éªŒè¯è¿‡æœŸç¼“å­˜ï¼‰ï¼Œåˆ°ä½¿ç”¨ç¼“å­˜çš„å“åº”å‘å‡ºæ—¶ç»è¿‡çš„ç§’æ•°
  â€¢ å¯¹äºä»£ç†æœåŠ¡å™¨ç®¡ç†çš„å…±äº«ç¼“å­˜ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ ¹æ® Age å¤´éƒ¨åˆ¤æ–­ç¼“å­˜æ—¶é—´
  â€¢ Age = delta-seconds

â€¢ current_age è®¡ç®—ï¼šcurrent_age = corrected_initial_age + resident_time;
  â€¢ resident_time = now - response_time(æ¥æ”¶åˆ°å“åº”çš„æ—¶é—´);
  â€¢ corrected_initial_age = max(apparent_age, corrected_age_value); ä¿®æ­£åçš„initial age
    â€¢ corrected_age_value = age_value + response_delay;
      â€¢ response_delay = response_time - request_time(å‘èµ·è¯·æ±‚çš„æ—¶é—´);  å®¢æˆ·ç«¯çš„æ—¶é—´ï¼Œè¯·æ±‚ï¼Œæ¥å—å“åº”
    â€¢ apparent_age = max(0, response_time - date_value); response_timeå®¢æˆ·ç«¯æ—¶é—´ï¼Œdate_valueæœåŠ¡å™¨æ—¶é—´ æœ‰å¯èƒ½å°äº0ï¼Œæ‰§è¡Œmax,ä¸èƒ½å°äº0
    
    
  

ä»£ç†æœåŠ¡å™¨ç¼“å­˜ä¸­çš„ Age å¤´éƒ¨
  å„ç§æ—¶é—´æ˜¯ä¸ºäº†ä¿®æ­£èŠ‚ç‚¹ä¹‹é—´çš„æ—¶å»¶ï¼Œè·Ÿlast-modified æ²¡æœ‰å…³ç³»
    
    
  
  
KrystalJake
è€å¸ˆå¯å¦è¯¦ç»†è§£é‡Šä¸€ä¸‹æœ€åè¿™ä¸ªä¾‹å­ï¼Œnow1ï¼Œnow2ï¼Œnow3ï¼Œè¿˜æœ‰åˆè¯•ageï¼Œageçš„è®¡ç®—ï¼Œæ„Ÿè§‰å’Œç»™çš„å…¬å¼å“ªä¸ªéƒ½å¯¹ä¸ä¸Šï¼Œæ¯”è¾ƒèƒ¡ä¹±çš„ä¸€ä¸ªè®¡ç®—ï¼Œè°¢è°¢ğŸ™
ä½œè€…å›å¤: å¾ˆå¥½çš„é—®é¢˜ï¼Œæˆ‘è¿™é‡Œåšäº†å¾ˆå¤šç®€åŒ–ï¼Œåº”è¯¥åœ¨PPTä¸ŠåŠ ä¸ªæ³¨é‡Šæ¯”è¾ƒå¥½ï¼šï¼ï¼‰
1ã€nowæ˜¯å“åº”ï¼’å‘å‡ºæ—¶çš„å½“å‰æ—¶é—´ï¼Œå› æ­¤è¯·æ±‚ï¼’çš„Age=response_time1-date1+now-response_time1=now-date1ã€‚è¿™ä¸ªä½ åº”è¯¥æ²¡æœ‰é—®é¢˜ã€‚
2ã€now2æ˜¯ä»£ç†æ¥æ”¶åˆ°å“åº”2çš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯response_time2ï¼Œ
æ•…Age=now-date1+response_time2-request_time2+now2-response_time2=now-date1-request_time2+now2ï¼Œ
è¿™é‡Œæˆ‘æŠŠnowæ›¿æ¢ä¸ºresponse_time2ï¼Œæ•…
Age=response_time2-date1-request_time2+now2ï¼Œæˆ‘åˆæŠŠå®ƒæ•´ç†ä¸ºnow2-date1+response_time2-request_time2ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œnow2-date1æ‰æ˜¯æœ€å…³é”®çš„ï¼Œå› ä¸ºresponse_delayå¯èƒ½åªæ˜¯ä¸€ä¸ªæå°å€¼ã€‚
3ã€now3æ˜¯å“åº”3å‘å‡ºçš„æ—¶é—´ï¼Œæ­¤æ—¶é‡å¤ç¬¬2æ­¥ï¼ŒæŠŠresponse_time2æ”¹æˆnow3å³å¯ã€‚    


ä¸€æ­¥

å¯¹äºä»£ç†æœåŠ¡å™¨çš„åˆå§‹ Age ,æ€ä¹ˆä¸€ä¼šç”¨ response_time -date1,ä¸€ä¼šç”¨ now-date1 çš„ï¼Ÿ
å¯¹äºCurrent-age è®¡ç®—è¿™ä¸€å—ï¼Œçœ‹äº†2éæ²¡æœ‰çœ‹æ‡‚æ€ç®—çš„ï¼Œéº»çƒ¦è€å¸ˆåœ¨è®²è§£ä¸€ä¸‹çš„
ä½œè€…å›å¤: æœ‰ä¸ªå‰æï¼šnow2=response_time2ã€‚
1ã€nowæ˜¯å“åº”ï¼’å‘å‡ºæ—¶çš„å½“å‰æ—¶é—´ï¼Œå› æ­¤è¯·æ±‚ï¼’çš„Age=response_time1-date1+now-response_time1=now-date1ã€‚
2ã€now2æ˜¯ä»£ç†æ¥æ”¶åˆ°å“åº”2çš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯response_time2ï¼Œ
æ•…Age=now-date1+response_time2-request_time2+now2-response_time2=now-date1-request_time2+now2ï¼Œ
è¿™é‡Œæˆ‘æŠŠnowæ›¿æ¢ä¸ºresponse_time2ï¼Œæ•…
Age=response_time2-date1-request_time2+now2ï¼Œæˆ‘åˆæŠŠå®ƒæ•´ç†ä¸ºnow2-date1+response_time2-request_time2ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œnow2-date1æ‰æ˜¯æœ€å…³é”®çš„ï¼Œå› ä¸ºresponse_delayå¯èƒ½åªæ˜¯ä¸€ä¸ªæå°å€¼ã€‚
3ã€now3æ˜¯å“åº”3å‘å‡ºçš„æ—¶é—´ï¼Œæ­¤æ—¶é‡å¤ç¬¬2æ­¥ï¼ŒæŠŠresponse_time2æ”¹æˆnow3å³å¯ã€‚



æ— å
é¢„ä¼°è¿‡æœŸæ—¶é—´ = (DownloadTime - LastModified) * 10%
resident_time = now - response_time(æ¥æ”¶åˆ°å“åº”çš„æ—¶é—´)
DownloadTimeå’Œresponse_timeæ˜¯åŒä¸€ä¸ªå€¼å—ï¼Ÿ
ä½œè€…å›å¤: æ˜¯çš„ã€‚å‚è§RFCæ–‡æ¡£ï¼šâ€œIf the response has a Last-Modified header field, caches are encouraged to use a heuristic expiration value that is no more than some fraction of the interval since that time.
   A typical setting of this fraction might be 10%.â€
   
 
magicnum
è€å¸ˆç¬¬äºŒä¸ªä»£ç†æœåŠ¡å™¨çš„åˆå§‹ageå¯ä»¥ç”¨åŸºäºdateè®¡ç®—ageï¼šresponse_time2-date1å§ï¼Ÿæ‚¨æ–‡ç¨¿ä¸­ç”¨çš„æ˜¯ç›¸å¯¹ageè®¡ç®—çš„
ä½œè€…å›å¤: ä¸å¯ä»¥ï¼Œå› ä¸ºå‘å‡ºå“åº”2æ—¶ï¼Œè¿˜æ²¡æœ‰response_time2è¿™ä¸ªæ—¶é—´ï¼Œå› ä¸ºåªæœ‰æ¥æ”¶åˆ°å“åº”æ‰æœ‰response_time2è¿™ä¸ªæ¦‚å¿µã€‚


ä¸€æ­¥
è®¡ç®—ageçš„æ—¶å€™ä¸ºä»€ä¹ˆè¦åŠ ä¸Šä¸€ä¸ª delayçš„å€¼å‘¢ï¼Ÿ å½“å‰æ—¶é—´å‡å»æºæœåŠ¡å™¨èµ„æºå“åº”çš„æ—¶é—´ä¸å°±æ˜¯ èµ„æºåˆ›å»ºçš„æ—¶é—´äº†å—ï¼Ÿ
ä½œè€…å›å¤: é˜²æ­¢ç½‘ç»œä¸­å‘é€å¤§åŒ…ä½“è€—æ—¶è¿‡é•¿ï¼Œå®å¯cacheç”¨ä¸äº†ï¼Œä¹Ÿä¸èƒ½è®©æœ¬è¯¥è¿‡æœŸçš„cacheè¿˜èƒ½ä½¿ç”¨
   