解决 HTTP/1 性能问题的 HTTP/2

• SPDY（2012-2016）  http/2的前身 Google做的努力，为了给http2让路，后续放弃支持
  spdy 在ssl和tcp层之上，spdy之上仍然是http
• HTTP2（RFC7540，2015.5）    
  • 在应用层上修改，基于并充分挖掘 TCP 协议性能      为了进行推广，只在应用层修改
  • 客户端向 server 发送 request 这种基本模型不会变。
  • 老的 scheme 不会变，没有 http2://。    没有http2.1 2.2的子协议
  • 使用 http/1.x 的客户端和服务器可以无缝的通过代理方式 转接到 http/2 上。
  • 不识别 http/2 的代理服务器可以将请求降级到 http/1.x     http/1.x与http/2可以双向互换
  
  
 
主流浏览器对 HTTP/2 的支持程度




HTTP/2 的应用状况
• 截止 2019.5.17 号，互联网上使用 HTTP/2 协议的站点已经达到 37.2%
• 快速推广的原因
  • 未改变 HTTP/1.1 的语义
  • 基于 TCP，仅在应用层变动    
    仅在应用层变动，影响范围小
    tcp,ip等下四层都在操作系统实现，并且涉及路由器，交互机等硬件
      ip6推广了很长时间，但是效果不理想


http2使用率  usage of http/2   
截止 2021.8.19 http/2使用率在46.1%   为啥没有到很高，多数网站不需要很高的性能，反而升级会带来问题  
https://w3techs.com/technologies/details/ce-http2
      

多路复用带来的提升   http/2最大特点
  理想的长肥管道
  

HTTP/2 的强大之处
https://http2.akamai.com/demo
将一个大图切割为多个小图加载   http/2的加载时间大幅降低  

Chrome的network中  选中img
  可以看到6条绿线，并发6条连接   拖动框住绿线的范围可以看到 http/1.1的连接   从左到右选中绿线即可
  蓝色的是http/2
  
  
  
  
  
HTTP/2 主要特性
• 传输数据量的大幅减少
  • 以二进制方式传输   http/1以ascii方式传输http header
  • 标头压缩   hpack
• 多路复用及相关功能   长肥网络
  • 消息优先级  多路复用的情况，支持消息的优先级
• 服务器消息推送
  • 并行推送
  
  
不能如期而至
概要面板中，HTTP1.1建立多个连接，然后发送请求，HTTP2只有一个连接，然后同时发送多个请求，这里HTTP2 速度快于HTTP1.1 是因为建立连接会耗时很多吗？
作者回复: 这是一个原因，还有以下原因：
1、HTTP2传输的数据量更小，因为同一个连接下HPACK可以基于时间做增量压缩，基于huffman算法做解决统计冗余问题，基于静态表使用二进制数字替代字符串。
2、基于优先级，浏览器可以指导服务器分配资源给不同的请求，使用户可体验的性能更好。
3、同一个TCP连接只有一次慢启动。
4、有些服务器配置了推送，性能更好。


Terry Hu
老师，关于长肥网络下同一个连接只能有6个TCP连接的问题，我有个疑惑。在应用层，一个TCP连接的内部，通过编程仍然可以做到异步发request，异步收response，第二个HTTP请求的发送并不是要等到第一个请求收到response才能发出去，（比如Java的Future API），这样也是并发的，那从Java开发的角度来说，HTTP2有什么优势呢？
作者回复: 没错，HTTP/1可以并发。HTTP2的优势是，TCP连接有个慢启动，它用于减少高流量下的恶性丢包，你可以参考第98课。而且新的HTTPS连接，TLS握手也很耗时，所以复用同一个TCP连接可以减少这些性能消耗。
当然，HTTP2还有很多特性也优于HTTP1，比如权重、RST关闭STREAM等等，你可以再细看看这一部分的后面的课程


1830
老师，请问http2具有传输的优势，为什么现在很多网站还是基于http1.1通信呢，http2在部署上有成本提高吗？还是什么原因没有去广泛的升级推广
作者回复: 不是所有网站都care性能优化的，他们可能更在乎业务流量。HTTP2部署非常成熟，虽然队头阻塞也是存在的，但一般相对HTTP1都有很大的性能提升。

小孩
有了http2还需要websocket吗
作者回复: http2里每条消息都是http语法，包括头部、URL、包体，而websocket则没有要求，它其实更像TCP。因此场景不同。


陆离

http2的传输方式改为二进制传输？之前是ASCII?额，不是很明白。
传输的时候不是都是转成二进制传输的吗？
作者回复: 比如一个数字10000如果是用ASCII编码，需要5个字节，而如果用整型编码，只要2个字节。后续HPACK算法介绍中你可以看到，http2对于用1个字节或者1个以上字节编码整数都不同


一步

HTTP2 和SPDY有什么区别呢？ SPDY 发展那么多年了， 突然蹦出来了一个 HTTP2 来代替SPDY, 难道是为了跟着 HTTP/1.1 命名保持一致吗？
作者回复: 1、spdy是google弄出来的，其他厂商不买帐，而http2不同，它是IETF规范，大家都有参与，这才能推广。
2、http2在hpack压缩算法上不同，hpack采用的是静态huffman树，后面课程会讲到。
3、http2是用tls中的ALPN来升级协议的，而且http2还支持h2c，这都是与SPDY不同的





         