实际通过openssl工具来进行rsa加密，解密


使用 openssl 基于 RSA 算法生成公私钥（1）
• 生成私钥（公私钥格式参见 RFC3447）   RFC3447规定了私钥的格式
 • openssl genrsa -out private.pem
-----BEGIN RSA PRIVATE KEY-----
xxxx
-----END RSA PRIVATE KEY-----


• 从私钥中提取出公钥   从私钥提取即可
  • openssl rsa -in private.pem -pubout -out public.pem
-----BEGIN PUBLIC KEY-----
xxxx
-----END PUBLIC KEY-----



• 查看 ASN.1 格式的私钥   私钥基于ASN.1格式编码
  • openssl asn1parse -i -in private.pem

RSAPrivateKey ::= SEQUENCE {          私钥格式  n,k,d,p,q,p-1,q-1 上一章加密的步骤    n和k需要记下来，和公钥中是一样的
   version Version,
   modulus INTEGER, -- n 
   publicExponent INTEGER, -- k 
   privateExponent INTEGER, -- d 
   prime1 INTEGER, -- p 
   prime2 INTEGER, -- q 
   exponent1 INTEGER, -- d mod (p-1) 
   exponent2 INTEGER, -- d mod (q-1) 
   coefficient INTEGER, -- (inverse of q) mod p 
   otherPrimeInfos OtherPrimeInfos OPTIONAL



查看 ASN.1 格式的公钥
 • openssl asn1parse -i -in public.pem    (X.590)
 • openssl asn1parse -i -in public.pem -strparse 19     19依赖于上一条命令的最后一行 BIT STRING
RSAPublicKey ::= SEQUENCE { 
  modulus INTEGER, -- n 
  publicExponent INTEGER -- k 
}

使用 RSA 公私钥加解密


• 加密文件  结果hello.en
  • openssl rsautl -encrypt -in hello.txt -inkey public.pem -pubin -out hello.en
• 解密文件  结果hello.de
  • openssl rsautl -decrypt -in hello.en -inkey private.pem -out hello.de





aaa
请问老师，一般都是公钥是分发到客户端，私钥是服务器存储的。从这节课学到的知识来看，那是不是意味着如果私钥分发到客户端，公钥留给服务器的话。是不是第三方就有可能通过私钥给算出公钥来？
作者回复: 这里openssl生成的私钥文件中包含了公钥，但并不是说私钥就包含公钥

一步
openssl 从私钥生成公钥的时候 -pubout 参数是起到什么作用的？
我直接 openssl rsa -in private.pem -out public.pem 也是可以的
作者回复: 指定生成公钥，这样命令更规范，你可以用openssl rsa --help命令查看参数，-pubout output a public key


二星球
老师好，请教个问题：同一个进程向一台主机连续发送2个请求，第二个请求比第一个请求的结果先返回，那么进程能够区分 返回的结果是那个请求发送的吗？如果能是靠什么区分的呢？我记得报文中有序列号，这个序列号是保证数据的有序性的，能用它区分不同请求的结果吗？
作者回复: 若两个请求跑在一条TCP连接上，那么如响应端有意将响应错序，一定是在应用层上做的，TCP层是无法识别的，应用头部可以区分，例如http2的stream_id






生成私钥
```
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEA3Ubgiibbtvkq8JG8JuB1THSaDbDgVtotzQKjZIXmBPU7m2ab
hOUg6KfFM834WQnKckH2qSJWklhe5a1Vx7P1i4gTeSJEzjOgRYDuxlAMflCumE3F
lLV14xKRQpfe/qqFDva1s8uo2D3tF/Bt2LvXtqu++Eb2apSrX3v/91A4C0EuMQX1
MG5a0iYn0FL+VWOXJObbfpvBFNNMr9hEyzCGiNgQi9b/zLjaThQml1bddHvEKc2A
mA21z5Uf8rQdxcrEyv77YGxx+wlLIM9/m5qAlxFOovuntYQpUJQwSblytmVK+l+m
20VFdDhc5TWjdqnHJRjVIOHumCJDbcq1Xkb0WQIDAQABAoIBAQDUis4HJUgKOs+5
/+IAXb2N0LpgyDLUegFgWFZlqg/FV2EH5ckgH446q1vKZN9VdwgUM7QfxbHuJCAS
8SniBsOmYPCDfB0nC4O4/x1bM2yssAbkmF9edeZkVGNe2c4CQ/xG4UarCsaF3wWr
5u88LUIIXnOyu0baHS93Kf41qcILW6kgNy6rW23o5sHmvCqEUlkiREvC5p98k6TB
2jiUwnFayiAeohddOOHBH9Os0xs3bCWpMvmgXa2BVW27v02LLfvmNawefWROKJHA
OhbVYe8rUSfUUH4lLhJ+jGiMPO2Xg/Eo+4mOHTMZDGJEMhq/tBsb2IDAFzvRHsNv
KQQsqbYBAoGBAPG0N3en4db4yk969MUrCwmlhvdGRreYIUQrX5RCleEFKATTqi6m
3Qg4wI5YrUJiZA1xH7OZE2tZw20JI5uAfiSj/7sBFKLoIqYbOT87SzuBoqArdi0r
GSKwXQzPZDI+cGF+0n4pxh1+vBrr0r04hb0lWKNuqFYJcipr7NZdtjx5AoGBAOpd
XImLVpfjdTGXhnI6Rpq8fda0niF1p8mwToQUk4/Vcna8c9BURnRFrnl5K9q+xrmF
n2rgeunhMWiqYTUp6nuuY1cYuwBGW5AsLkTu3pQtI9dQrtPEDxIPFjXARkuNess4
87QDL5cA9rnHAZyJzXziUUJ9RKp5Uah3F5Sfir7hAoGAfn4sUSjBHnoRlsroco92
NVQ1cA+NTuQE9OImITc/rQW/zdbgR434OydITrbF5eoMJqS/TISeDx5pEhUoV2dF
nPNfEIUeQatvBrNUoGztkHTloSFdtYHKo8bcy6l17H2U3tE6Y+CE2EbNNuGX5oNA
Kp7y5oUw/+Xto5nb1swwZTECgYA/+rq/ZcV+835TynzOhDAwH9LuoSImGjty6OmW
TxO1iVyVI38uWUNejIND8BtTvQ79KIhLofqMDIjzfMfKvqWfnAzMgxjRy2NFqXn8
IYWrx+Ln7cO8VeKTWIEErXfDOl1SSzrkYpZET+QK9VPwSwJI3HO4hgAP1czAA7rx
PNigoQKBgD1OJd1OfbaMj4Dl+lsyPD7DYORGNlTMJKYXfaWz60g0WZ0FAhhOYEEo
RKNCZmqAYChNxkRZiExzbVPLZEtPkyObY27WL959Qlp6p4U6bOy71hfPtEVRsVE2
7xUHSQ//7MibBn1IQ2My53vtJofRGoSe66zS+N9CriH+8/+qnLIl
-----END RSA PRIVATE KEY-----
```

提取公钥
```
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3Ubgiibbtvkq8JG8JuB1
THSaDbDgVtotzQKjZIXmBPU7m2abhOUg6KfFM834WQnKckH2qSJWklhe5a1Vx7P1
i4gTeSJEzjOgRYDuxlAMflCumE3FlLV14xKRQpfe/qqFDva1s8uo2D3tF/Bt2LvX
tqu++Eb2apSrX3v/91A4C0EuMQX1MG5a0iYn0FL+VWOXJObbfpvBFNNMr9hEyzCG
iNgQi9b/zLjaThQml1bddHvEKc2AmA21z5Uf8rQdxcrEyv77YGxx+wlLIM9/m5qA
lxFOovuntYQpUJQwSblytmVK+l+m20VFdDhc5TWjdqnHJRjVIOHumCJDbcq1Xkb0
WQIDAQAB
-----END PUBLIC KEY-----
```

分析私钥格式   n DD46xx   k010001
```
 0:d=0  hl=4 l=1187 cons: SEQUENCE          
    4:d=1  hl=2 l=   1 prim:  INTEGER           :00
    7:d=1  hl=4 l= 257 prim:  INTEGER           :DD46E08A26DBB6F92AF091BC26E0754C749A0DB0E056DA2DCD02A36485E604F53B9B669B84E520E8A7C533CDF85909CA7241F6A9225692585EE5AD55C7B3F58B8813792244CE33A04580EEC6500C7E50AE984DC594B575E312914297DEFEAA850EF6B5B3CBA8D83DED17F06DD8BBD7B6ABBEF846F66A94AB5F7BFFF750380B412E3105F5306E5AD22627D052FE55639724E6DB7E9BC114D34CAFD844CB308688D8108BD6FFCCB8DA4E14269756DD747BC429CD80980DB5CF951FF2B41DC5CAC4CAFEFB606C71FB094B20CF7F9B9A8097114EA2FBA7B5842950943049B972B6654AFA5FA6DB454574385CE535A376A9C72518D520E1EE9822436DCAB55E46F459
  268:d=1  hl=2 l=   3 prim:  INTEGER           :010001
  273:d=1  hl=4 l= 257 prim:  INTEGER           :D48ACE0725480A3ACFB9FFE2005DBD8DD0BA60C832D47A0160585665AA0FC5576107E5C9201F8E3AAB5BCA64DF5577081433B41FC5B1EE242012F129E206C3A660F0837C1D270B83B8FF1D5B336CACB006E4985F5E75E66454635ED9CE0243FC46E146AB0AC685DF05ABE6EF3C2D42085E73B2BB46DA1D2F7729FE35A9C20B5BA920372EAB5B6DE8E6C1E6BC2A84525922444BC2E69F7C93A4C1DA3894C2715ACA201EA2175D38E1C11FD3ACD31B376C25A932F9A05DAD81556DBBBF4D8B2DFBE635AC1E7D644E2891C03A16D561EF2B5127D4507E252E127E8C688C3CED9783F128FB898E1D33190C6244321ABFB41B1BD880C0173BD11EC36F29042CA9B601
  534:d=1  hl=3 l= 129 prim:  INTEGER           :F1B43777A7E1D6F8CA4F7AF4C52B0B09A586F74646B79821442B5F944295E1052804D3AA2EA6DD0838C08E58AD4262640D711FB399136B59C36D09239B807E24A3FFBB0114A2E822A61B393F3B4B3B81A2A02B762D2B1922B05D0CCF64323E70617ED27E29C61D7EBC1AEBD2BD3885BD2558A36EA85609722A6BECD65DB63C79
  666:d=1  hl=3 l= 129 prim:  INTEGER           :EA5D5C898B5697E375319786723A469ABC7DD6B49E2175A7C9B04E8414938FD57276BC73D054467445AE79792BDABEC6B9859F6AE07AE9E13168AA613529EA7BAE635718BB00465B902C2E44EEDE942D23D750AED3C40F120F1635C0464B8D7ACB38F3B4032F9700F6B9C7019C89CD7CE251427D44AA7951A87717949F8ABEE1
  798:d=1  hl=3 l= 128 prim:  INTEGER           :7E7E2C5128C11E7A1196CAE8728F76355435700F8D4EE404F4E22621373FAD05BFCDD6E0478DF83B27484EB6C5E5EA0C26A4BF4C849E0F1E691215285767459CF35F10851E41AB6F06B354A06CED9074E5A1215DB581CAA3C6DCCBA975EC7D94DED13A63E084D846CD36E197E683402A9EF2E68530FFE5EDA399DBD6CC306531
  929:d=1  hl=3 l= 128 prim:  INTEGER           :3FFABABF65C57EF37E53CA7CCE8430301FD2EEA122261A3B72E8E9964F13B5895C95237F2E59435E8C8343F01B53BD0EFD28884BA1FA8C0C88F37CC7CABEA59F9C0CCC8318D1CB6345A979FC2185ABC7E2E7EDC3BC55E293588104AD77C33A5D524B3AE46296444FE40AF553F04B0248DC73B886000FD5CCC003BAF13CD8A0A1
 1060:d=1  hl=3 l= 128 prim:  INTEGER           :3D4E25DD4E7DB68C8F80E5FA5B323C3EC360E4463654CC24A6177DA5B3EB4834599D0502184E60412844A342666A8060284DC64459884C736D53CB644B4F93239B636ED62FDE7D425A7AA7853A6CECBBD617CFB44551B15136EF1507490FFFECC89B067D48436332E77BED2687D11A849EEBACD2F8DF42AE21FEF3FFAA9CB225
```

公钥格式openssl asn1parse -i -in public.pem
```
 0:d=0  hl=4 l= 290 cons: SEQUENCE          
    4:d=1  hl=2 l=  13 cons:  SEQUENCE          
    6:d=2  hl=2 l=   9 prim:   OBJECT            :rsaEncryption
   17:d=2  hl=2 l=   0 prim:   NULL              
   19:d=1  hl=4 l= 271 prim:  BIT STRING  
``` 

n  DD46xx  k 010001  openssl asn1parse -i -in public.pem -strparse 19
```    
 0:d=0  hl=4 l= 266 cons: SEQUENCE          
    4:d=1  hl=4 l= 257 prim:  INTEGER           :DD46E08A26DBB6F92AF091BC26E0754C749A0DB0E056DA2DCD02A36485E604F53B9B669B84E520E8A7C533CDF85909CA7241F6A9225692585EE5AD55C7B3F58B8813792244CE33A04580EEC6500C7E50AE984DC594B575E312914297DEFEAA850EF6B5B3CBA8D83DED17F06DD8BBD7B6ABBEF846F66A94AB5F7BFFF750380B412E3105F5306E5AD22627D052FE55639724E6DB7E9BC114D34CAFD844CB308688D8108BD6FFCCB8DA4E14269756DD747BC429CD80980DB5CF951FF2B41DC5CAC4CAFEFB606C71FB094B20CF7F9B9A8097114EA2FBA7B5842950943049B972B6654AFA5FA6DB454574385CE535A376A9C72518D520E1EE9822436DCAB55E46F459
  265:d=1  hl=2 l=   3 prim:  INTEGER           :010001
```