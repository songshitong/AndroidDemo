RSA 密钥交换
  • 由客户端生成对称加密的密钥
  • 问题：没有前向保密性    破解服务器的私钥后，以前的报文也可以解密了
    斯诺登事件，某CA机构公布了一个服务器的私钥


DH 密钥交换
• 1976 年由 Bailey Whitfield Diffie 和 Martin Edward Hellman 首次发表，故称为 Diffie–Hellman key exchange，简称 DH
• 它可以让双方在完全没有对方任何预先信息的条件下通过不安全信道创建起一个密钥    这是DH目的
  每次秘钥是实时生成的，具备前向保密性
  client，server 分别生成自己的公私钥   根据对方的公钥和自己的私钥有生成一个相同的秘钥用于后面的报文


DH 密钥交换协议举例（1）


DH 密钥交换协议举例（2）



DH 密钥交换协议的问题

• 中间人伪造攻击
  • 向 Alice 假装自己是 Bob，进行一次 DH 密钥交换
  • 向 Bob 假装自己是 Alice，进行一次 DH 密钥交换
• 解决中间人伪造攻击   PKI，没法假装Bob，Alice身份
  • 身份验证




胡波 allenhu
老师你好，DH如何做到前向保密？是每一次传输都都会先通过DH协商对称密钥吗？如果这样，每次client和server都需要产生新的public/private key，效率是不是不高？而且为什么当用RSA做密钥交换时，每次都由client生成一个随机的对称密钥，既效率高，而且也可以前向保密？
作者回复: 1、DH每次握手都生成不同的对称密钥，因此具有前向保密。
2、是，所以基于椭圆曲线的ECDH才会应运而生。
3、RSA没有前向保密，只要破解了服务器私钥后，可以从握手中获得对称密钥。


一禅
请教老师，服务器端不是应该事先将公钥发送给ca机构进行加密么，如果server端每次都新生成公钥，岂不是每个请求过来了，server端都要先把新生成的公钥发送给ca制作成证书，然后再返回给客户端进行验签？
作者回复: 你好一禅，身份认证与对称加密的密钥协商是2个完全不同的过程。
1、身份认证是通过CA机构进行的，公钥、私钥通常几个月会更新1次。
2、这一讲中的内容，是1次TLS会话中，如何在公开链路中生成1次性的密钥。这个过程中，同样使用了非对称加密算法的思想，每次客户端、服务器都会生成公、私钥对。

TerryGoForIt
老师您好，在斯诺登那段，您说“某个 CA 结构迫于政府的鸭梨透漏了某个 Server 的私钥”，可是 Server 只会给 CA 它的公钥啊。
作者回复: CA机构都会要求server把私钥也传给他


